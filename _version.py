"""
DO NOT EDIT - Auto-generated file
Generated by talon-manifest-tools v2.0.0

This file provides:
- Package version checking via mouse_rig_version() action
- Automatic dependency validation on startup
"""
import json
import os
from talon import Module, actions, app

mod = Module()

@mod.action_class
class Actions:
    def mouse_rig_version() -> tuple[int, int, int]:
        """Returns the package version as (major, minor, patch)"""
        manifest_path = os.path.join(os.path.dirname(__file__), 'manifest.json')
        with open(manifest_path, 'r', encoding='utf-8') as f:
            version_str = json.load(f)['version']
        return tuple(map(int, version_str.split('.')))

def validate_dependencies():
    try:
        with open(os.path.join(os.path.dirname(__file__), 'manifest.json'), 'r') as f:
            data = json.load(f)

        deps = data.get('dependencies', {})
        errors = []

        for dep, info in deps.items():
            version_action = f"{info['namespace']}_version"
            github_url = info.get('github', '')
            try:
                installed = getattr(actions, version_action)()
                required = tuple(int(x) for x in info['version'].split('.'))
                if installed < required:
                    installed_str = '.'.join(map(str, installed))
                    errors.append(f"  Update {dep} to {info['version']}+ (currently {installed_str})")
                    if github_url:
                        errors.append(f"    Navigate to the {dep} directory and run: git pull")
                        errors.append(f"    {github_url}")
            except AttributeError:
                errors.append(f"  Install {dep} (missing {version_action})")
                if github_url:
                    errors.append(f"    Clone to your talon user directory:")
                    errors.append(f"    git clone {github_url}")
            except Exception as e:
                errors.append(f"  {dep}: {e}")

        if errors:
            print(f"\n{data.get('name')}: dependency not met")
            for error in errors:
                print(error)
            print("  WARNING: Review code from unfamiliar sources before installing")
            print("  Note: Restart Talon after updating dependencies")
            print()
    except:
        pass

app.register("ready", validate_dependencies)
